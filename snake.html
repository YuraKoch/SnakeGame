<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <title>Snake</title>
  <style>
    html {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    body {
      width: 100%;
      height: 100%;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    canvas{
      background: #000;
    }
  </style>
</head>
<body>
<canvas width="600" height="600">HTML 5 не поддерживется</canvas>
 
<script type="application/javascript">
  let canvas = document.querySelector("canvas"),
      ctx = canvas.getContext("2d"),
      cellSize = 25, //Размер элемента змейки
      positionX = canvas.width/2 - cellSize, positionY = canvas.height/2 - cellSize, //Координаты позиции змейки, со стартовой позицией
      dx = 0, dy = 0, //Направление (вектор) движения змейки
      xZarr = [], yZarr = [], //Массивы координат змейки
      snakeArr = [{x: positionX, y: positionY}],
      fruit, //Объект с координатами позиции фрукта
      snakeLength = 1; //Длина змеи. По умолчанию 1.
  
  // canvas.width = document.body.clientWidth;
  // canvas.height = document.body.clientHeight;
  

  //Функция случайного выбора координат c учетом ширины клетки
  function randomPosition(max, cell) {
      return Math.floor(Math.random()*max/cell)*cell;
  }
  
  //Функция случайного выбора координат для фрукта
  function createFruit() {
      let obj = {};
      do {            
          obj.x = randomPosition(canvas.width, cellSize);
          obj.y = randomPosition(canvas.height, cellSize);
      }
      while (snakeArr.some(item => obj.x === item.x && obj.y === item.y))
      return obj;
  }
  
  fruit = createFruit(); //Вызываем функцию для расчета случайной стартовой позиции фрукта

  //Функция обнуления змейки при столкновении с хвостом
  // function feil() {
  //     ctx.fillStyle="White"; //Вспышка при столкновении
  //     ctx.fillRect(0, 0, canvas.width, canvas.height);
  //     xZarr.length=1; //Стираем X-массив змейки до 1 элемента
  //     yZarr.length=1; //Стираем Y-массив змейки до 1 элемента
  //     snakeLength=0; //Обнуляем счетчик
  // };
  
  //Отслеживаем нажатие клавиш в потоке событий
  const   KEY_LEFT  = 37,
          KEY_UP    = 38,
          KEY_RIGHT = 39,
          KEY_DOWN  = 40;

  document.addEventListener('keydown',function(event) {
      event.preventDefault(); //Отменяются исполнения браузером событий event, что-бы не срабатывал скролл(прокрутка) страниц, при нажатии стрелок
      if      (event.keyCode == KEY_LEFT  && dx == 0) {dx=-1; dy=0;} //Влево
      else if (event.keyCode == KEY_UP    && dy == 0) {dx=0; dy=-1;} //Вверх
      else if (event.keyCode == KEY_RIGHT && dx == 0) {dx=1; dy=0;} //Вправо
      else if (event.keyCode == KEY_DOWN  && dy == 0) {dx=0; dy=1;} //Вниз
  });
  
  //Функция отрисовки кадра через интервал времени
  setInterval(function() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      //Цвет и позиция фрукта
      ctx.fillStyle="red";
      ctx.fillRect(fruit.x+1, fruit.y+1, cellSize-2, cellSize-2);
      
      //Рассчитываем координаты при движении и телепортируем при выходе за края
      positionX += dx*cellSize;
      if (positionX >= canvas.width) positionX = 0;
      if (positionX < 0) positionX = canvas.width-cellSize;

      positionY += dy*cellSize;
      if (positionY >= canvas.height) positionY = 0;
      if (positionY < 0) positionY = canvas.height-cellSize;
      
      //Проверка на столкновение
      // for (let i=0; i<=(snakeLength); i++) if (xZarr[i]==positionX && yZarr[i]==positionY) feil();
      
      //Добавляем координаты в начальный элемент массива
      snakeArr.unshift({x:positionX, y:positionY});
      console.log(snakeArr.length);
      
      //Цикл вывода элементов змейки с отрисовкой
      ctx.fillStyle="lime";
      for (let i=0; i < snakeLength; i++) {
          ctx.fillRect(snakeArr[i].x+1, snakeArr[i].y+1, cellSize-2, cellSize-2); //Отрисовка массива змейки
      }
      
      //Кушаем фрукт, при совпадении координат головы змеи и фрукта - выводим новый фрукт и счетчик +1
      if (fruit.x == positionX && fruit.y == positionY) {
          snakeLength++;
          fruit = createFruit();
      } else {
          //Иначе - стираем хвост, т.е. змейка перемещается без прироста
          snakeArr.pop();
      }
      
  }, 1000/15); //Пауза (кадров в секунду)
</script>
</body>
</html>